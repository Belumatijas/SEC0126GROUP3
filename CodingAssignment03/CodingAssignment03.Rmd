---
title: "Coding Assignment 3"
author: "Team 3"
date: "Due: 2021-12-09 23:59"
output:
  html_document:
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
install.packages("ggplot2")
library(readxl)
library(plotly)
library(car)
library(corrplot)
library(jtools)
library(gt)
library(gtsummary)
library(ggplot2)



knitr::opts_chunk$set(echo = TRUE)

```

A Florida health insurance company wants to predict annual claims for individual clients. The company pulls a random sample of 50 customers. The owner wishes to charge an actuarially fair premium to ensure a normal rate of return. The owner collects all of their current customer’s health care expenses from the last year and compares them with what is known about each customer’s plan. 

The data on the 50 customers in the sample is as follows:

-	Charges: Total medical expenses for a particular insurance plan (in dollars)
-	Age: Age of the primary beneficiary
-	BMI: Primary beneficiary’s body mass index (kg/m2)
-	Female: Primary beneficiary’s birth sex (0 = Male, 1 = Female)
-	Children: Number of children covered by health insurance plan (includes other dependents as well)
-	Smoker: Indicator if primary beneficiary is a smoker (0 = non-smoker, 1 = smoker)
-	Cities: Dummy variables for each city with the default being Sanford

Answer the following questions using complete sentences and attach all output, plots, etc. within this report.


```{r dataset, include=FALSE}
insurance <- read.csv("~/GitHub/SEC0126GROUP3/Data/insurance_0126_Group3.csv")
summary(insurance)
```
Here are just reading in all data to which we will run all the analysis. 

## Question 1

Randomly select three observations from the sample and exclude from all modeling (i.e. n=47). Provide the summary statistics (min, max, std, mean, median) of the quantitative variables for the 47 observations.

```{r Q1 subsets & summary}
set.seed(123456)
index <- sample(seq_len(nrow(insurance)), size = 3) 

training_set <- insurance[-index,] #everything but the three rows we dropped / 47 observations

testing_set <- insurance[index,] #the three rows we pulled put. 

summary(training_set[,c(1:3,5)]) # only looking at the quantitative variables and the 47 observations. 
```
We have taken our 50 oberstaions and created two new subsets of data. 
The first one is called the training set. This one concists of 47 observations out of the 50. 
The second one is called the testing set. We have pulled three random observation rows to use later and test our results against. 


```{r Q1.2 standard deviation}

sd(training_set$Charges, na.rm = TRUE)

sd(training_set$Age, na.rm = TRUE)

sd(training_set$BMI, na.rm = TRUE)

sd(training_set$Children, na.rm = TRUE)
```
Charges is skewed to the Right because the mean is greater than the median, which means there might be some outliers. 

Age has a approximately normal distribution because the mean and median are similar. 

BMI has a approximately normal distribution because the mean and median are similar.   

**Children is skewed to the Right because the mean is greater than the median, which means there might be some outliers. 

## Question 2

Provide the correlation between all quantitative variables

```{r Q2}
cor(training_set[c(1:3,5)])
corrplot((cor(training_set[,c(1:3,5)])) type = "upper", order = "hclust", tl.col = "black", tl.srt = 45)
```
Based on the data above, all the values are below .5 therefore indicating that they are not highly correlated. No evidence of multicollinearity. There are a few items that are at .4 which may effect 

## Question 3

Run a regression that includes all independent variables in the data table. Does the model above violate any of the Gauss-Markov assumptions? If so, what are they and what is the solution for correcting?
```{r Q3}
model_1 <- lm(Charges ~. , data = training_set)
summary(model_1)
par(mfrow=c(2,2))
plot(model_1)

```
[insert analysis part here ]

```{r q3.2}
scatterplotMatrix(training_set[-c(4,6:9)])

```
From here you can see some non-linear relationships and non-normally distributed variables. Transformations are needed in order to account for the nonlinear relationships.


Age and Charges appear to not have a linear relationship, we will transform this by a log function. Taking logs will bring outliers closer to the other charges
BMI & Charges looks to have a heteroskadistiy relationship, we will fix with a log function. 
Children& Charges appear to not have a linear relationship, we will transform this by a log function. Taking logs will bring outliers closer to the other charges

## Question 4

Implement the solutions from question 3, such as data transformation, along with any other changes you wish. Use the sample data and run a new regression. How have the fit measures changed? How have the signs and significance of the coefficients changed?

```{r Q4 1 transformation}
training_set$LnAge <- log(training_set$Age)
                                 
hist(training_set$Age) #before
hist(training_set$LnAge) #after
scatterplotMatrix(training_set[c(1,2,10)])

model_transformation1 <- lm(Charges ~., data = training_set[,c(10,1,4,6:9)])
summary(model_transformation1)
```

```{r Q4 2 transformation}
[insert new columns for the adjustments we are wanting to make] 
histogram of variable 
histogram of transformed variable
scatterplotmatrix(trainging_set[select the columns you want as dependent first , then all the others needed)])
model_transformation2 <- lm()
summary(model_transformation2)
```
```{r Q4 3 transformation}
[insert new columns for the adjustments we are wanting to make] 
histogram of variable 
histogram of transformed variable
scatterplotmatrix(trainging_set[select the columns you want as dependent first , then all the others needed)])
model_transformation3 <- lm()
summary(model_transformation3)
```
## Question 5

Use the 3 withheld observations and calculate the performance measures for your best two models. Which is the better model? (remember that "better" depends on whether your outlook is short or long run)

```{r Q5}
testing_set HELP! 
```


## Question 6

Provide interpretations of the coefficients, do the signs make sense? Perform marginal change analysis (thing 2) on the independent variables.

```{r Q6}
HELP! 
```

## Question 7

An eager insurance representative comes back with five potential clients. Using the better of the two models selected above, provide the prediction intervals for the five potential clients using the information provided by the insurance rep.

| Customer | Age | BMI | Female | Children | Smoker | City           |
| -------- | --- | --- | ------ | -------- | ------ | -------------- | 
| 1        | 60  | 22  | 1      | 0        | 0      | Oviedo         |
| 2        | 40  | 30  | 0      | 1        | 0      | Sanford        |
| 3        | 25  | 25  | 0      | 0        | 1      | Winter Park    |
| 4        | 33  | 35  | 1      | 2        | 0      | Winter Springs |
| 5        | 45  | 27  | 1      | 3        | 0      | Oviedo         |

```{r q7a}
anova(model,model2) ## need to compare our two models to find out which one is better. THEN we can use that one for anyalysis below 
```

```{r Q7.1}
####### need to deicide westher the training model or the testing model is best. Then adjust the the formulas to reflect...I think ######
model_1 <- lm(Charges ~ Age + BMI + Children + Female + Smoker + WinterSprings + WinterPark + Oviedo, data = training_set)

Customer1 <- data.frame(Age = 60,
BMI = 22,
Female = 1,
Children = 0,
Smoker = 0,
City = Oviedo)

predict(model_1, newdata = training_set,interval = "prediction")
```
Customer #1 will pay on average $___. We are 95% confident that a person with these charateristics will pay between ____ and ____.  

```{r Q7.2}
Customer2 <- data.frame(Age = 40,
BMI = 30,
Female = 0,
Children = 1,
Smoker = 0,
City = Sanford)

predict(model_1, newdata = training_set,interval = "prediction")
```

Customer #2 will pay on average $___. We are 95% confident that a person with these charateristics will pay between ____ and ____.  

```{r Q7.3}
Customer3 <- data.frame(Age = 25,
BMI = 25,
Female = 0,
Children = 0,
Smoker = 1,
City = WinterPark)
predict(model_1, newdata = training_set,interval = "prediction")
```
Customer #3 will pay on average $___. We are 95% confident that a person with these charateristics will pay between ____ and ____.  

```{r Q7.4}
Customer4 <- data.frame(Age = 33,
BMI = 35,
Female = 1,
Children = 2,
Smoker = 0,
City = WinterSprings)
predict(model_1, newdata = training_set,interval = "prediction")
```
Customer #4 will pay on average $___. We are 95% confident that a person with these charateristics will pay between ____ and ____.  

```{r Q7.5}
Customer5 <- data.frame(Age = 45,
BMI = 27,
Female = 1,
Children = 3,
Smoker = 0,
City = Oviedo)
predict(model_1, newdata = training_set,interval = "prediction")
```

Customer #5 will pay on average $___. We are 95% confident that a person with these charateristics will pay between ____ and ____.  


## Question 8

The owner notices that some of the predictions are wider than others, explain why.
 
 [ANSWER IN COMPLETE SENTENCES]
## Question 9 

Are there any prediction problems that occur with the five potential clients? If so, explain.

[ANSWER IN COMPLETE SENTENCES]

